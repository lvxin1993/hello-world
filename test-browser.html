<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta httpEquiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>SleepWell - 测试页面</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .warning { background-color: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <h1>SleepWell 浏览器兼容性测试</h1>
    <div id="test-results"></div>
    
    <script>
        const results = document.getElementById('test-results');
        
        function addResult(message, type = 'success') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }
        
        // 基础测试
        addResult('浏览器基本信息:');
        addResult(`User Agent: ${navigator.userAgent}`, 'warning');
        addResult(`浏览器名称: ${navigator.appName}`, 'warning');
        
        // JavaScript支持测试
        try {
            addResult('JavaScript支持: ✓');
            
            // ES6+ 特性测试
            const testES6 = () => {
                const arrow = () => 'test';
                const template = `template ${arrow()}`;
                const [a, b] = [1, 2];
                const spread = {...{x: 1}, y: 2};
                return true;
            };
            
            if (testES6()) {
                addResult('ES6+ 特性支持: ✓');
            }
        } catch (e) {
            addResult(`JavaScript错误: ${e.message}`, 'error');
        }
        
        // React Native Web 相关测试
        try {
            addResult('全局对象测试:');
            addResult(`window对象: ${typeof window}`, 'warning');
            addResult(`document对象: ${typeof document}`, 'warning');
            addResult(`globalThis对象: ${typeof globalThis}`, 'warning');
            
            // 检查必要的DOM API
            if (document.getElementById && document.createElement) {
                addResult('DOM API支持: ✓');
            }
            
            if (window.fetch) {
                addResult('Fetch API支持: ✓');
            } else {
                addResult('Fetch API不支持', 'error');
            }
            
        } catch (e) {
            addResult(`环境测试错误: ${e.message}`, 'error');
        }
        
        // 加载原始应用并捕获错误
        addResult('正在尝试加载原始应用...', 'warning');
        
        // 创建一个script标签来加载应用
        const script = document.createElement('script');
        script.src = './_expo/static/js/web/AppEntry-e4617e58fe499b6e9b1217e203ffb406.js';
        script.defer = true;
        
        script.onload = () => {
            addResult('应用脚本加载成功: ✓');
        };
        
        script.onerror = (error) => {
            addResult(`应用脚本加载失败: ${error.message || '未知错误'}`, 'error');
            addResult('可能的原因: 路径错误、文件不存在或网络问题', 'error');
        };
        
        document.head.appendChild(script);
        
        // 监听全局错误
        window.addEventListener('error', (event) => {
            addResult(`全局错误: ${event.message} at ${event.filename}:${event.lineno}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            addResult(`未处理的Promise拒绝: ${event.reason}`, 'error');
        });
        
        addResult('测试完成。检查控制台获取更多信息。', 'success');
    </script>
</body>
</html>