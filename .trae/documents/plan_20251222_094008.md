# 旋转模式卡片不可见问题分析与修复方案

## 问题分析

通过对代码的深入分析，发现旋转模式下卡片不可见的问题可能由以下几个原因导致：

1. **滚动定位问题**：`RotatingModeView` 组件中，自动旋转动画的初始定位和边界处理逻辑存在缺陷
2. **卡片尺寸与屏幕不匹配**：卡片固定宽度为 330，但没有考虑不同屏幕尺寸的适配
3. **自动旋转逻辑**：`requestAnimationFrame` 驱动的滚动动画可能导致卡片滚动到可视区域外

## 核心问题定位

1. **初始定位逻辑**：
   - 在 `RotatingModeView.js` 第 40-47 行，初始定位使用 `setTimeout` 延迟执行，可能导致定位不准确
   - 第 21 行计算 `blockWidth = menuItems.length * 330`，但初始定位到 `blockWidth` 位置，可能导致卡片不在可视区域

2. **自动旋转边界处理**：
   - 第 27-28 行的边界处理逻辑可能导致卡片滚动到不可见区域
   - 当 `rotationDirection` 为逆时针时，可能出现滚动位置计算错误

3. **scrollViewRef 获取**：
   - 确保 `scrollViewRef` 正确获取，否则滚动动画不会执行

## 修复方案

### 1. 优化初始定位逻辑

- 移除 `setTimeout` 延迟，直接在 `useEffect` 中执行初始定位
- 确保初始定位位置在可视区域内

### 2. 修复自动旋转边界处理

- 优化边界检测逻辑，确保卡片始终在可视区域内
- 调整滚动位置计算，考虑屏幕宽度和卡片宽度的关系

### 3. 增强 scrollViewRef 处理

- 添加安全检查，确保 `scrollViewRef` 存在再执行滚动操作
- 优化滚动动画的流畅性

### 4. 确保 menuItems 数据正确传递

- 检查 `visibleItems` 过滤逻辑，确保可见卡片被正确传递
- 验证 `customMenuItems` 中的卡片 `visible` 属性设置

## 预期修复效果

1. 旋转模式下卡片能够正常显示
2. 自动旋转动画流畅，卡片始终在可视区域内
3. 支持不同屏幕尺寸的适配
4. 手动和自动模式切换正常

## 修复步骤

1. 修改 `RotatingModeView.js` 中的初始定位逻辑
2. 优化自动旋转的边界处理
3. 增强 `scrollViewRef` 的安全检查
4. 验证 `menuItems` 数据传递
5. 测试不同屏幕尺寸和旋转方向下的显示效果