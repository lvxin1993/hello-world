<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta httpEquiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>SleepWell - è¯Šæ–­é¡µé¢</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result { 
            margin: 10px 0; 
            padding: 15px; 
            border-radius: 8px;
            border-left: 4px solid;
            font-size: 14px;
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            border-left-color: #28a745;
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            border-left-color: #dc3545;
        }
        .warning { 
            background: #fff3cd; 
            color: #856404; 
            border-left-color: #ffc107;
        }
        .info { 
            background: #d1ecf1; 
            color: #0c5460; 
            border-left-color: #17a2b8;
        }
        h1 { color: #333; text-align: center; }
        .loading { text-align: center; padding: 20px; }
        .spinner { 
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4A90E2;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error-details { 
            background: #f8f9fa; 
            padding: 10px; 
            border-radius: 5px; 
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 10px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ› ï¸ SleepWell åº”ç”¨è¯Šæ–­</h1>
        <div id="test-results">
            <div class="test-result info">æ­£åœ¨è¯Šæ–­åº”ç”¨å…¼å®¹æ€§é—®é¢˜...</div>
            <div class="loading">
                <div class="spinner"></div>
                <div>æ­£åœ¨æ£€æµ‹æµè§ˆå™¨å…¼å®¹æ€§...</div>
            </div>
        </div>
    </div>
    
    <script>
        const results = document.getElementById('test-results');
        let errorCount = 0;
        
        function addResult(message, type = 'success') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            if (type === 'error') errorCount++;
        }
        
        function clearLoading() {
            const loading = results.querySelector('.loading');
            if (loading) loading.remove();
        }
        
        // æµè§ˆå™¨å…¼å®¹æ€§æ£€æµ‹
        setTimeout(() => {
            clearLoading();
            
            addResult('<strong>ğŸ” æµè§ˆå™¨ç¯å¢ƒæ£€æµ‹</strong>', 'info');
            
            // åŸºç¡€ä¿¡æ¯
            addResult(`ğŸ“± User Agent: ${navigator.userAgent.substring(0, 100)}...`, 'warning');
            addResult(`ğŸŒ æµè§ˆå™¨è¯­è¨€: ${navigator.language}`, 'warning');
            addResult(`ğŸ“ å±å¹•å°ºå¯¸: ${window.innerWidth}Ã—${window.innerHeight}`, 'warning');
            
            // JavaScriptæ”¯æŒæ£€æµ‹
            addResult('<strong>âš¡ JavaScript æ”¯æŒæ£€æµ‹</strong>', 'info');
            
            try {
                // ES6+ ç‰¹æ€§æµ‹è¯•
                const es6Tests = [
                    { name: 'ç®­å¤´å‡½æ•°', test: () => (() => true)() },
                    { name: 'æ¨¡æ¿å­—ç¬¦ä¸²', test: () => `test ${1 + 1}` === 'test 2' },
                    { name: 'è§£æ„èµ‹å€¼', test: () => { const [a, b] = [1, 2]; return a === 1 && b === 2; } },
                    { name: 'æ‰©å±•è¿ç®—ç¬¦', test: () => { const obj = {...{x: 1}, y: 2}; return obj.x === 1 && obj.y === 2; } },
                    { name: 'Promise', test: () => typeof Promise !== 'undefined' },
                    { name: 'async/await', test: () => { try { eval('async () => {}'); return true; } catch { return false; } } },
                    { name: 'ç±»', test: () => { try { eval('class Test {}'); return true; } catch { return false; } } }
                ];
                
                es6Tests.forEach(({name, test}) => {
                    try {
                        if (test()) {
                            addResult(`âœ… ${name}: æ”¯æŒ`);
                        } else {
                            addResult(`âŒ ${name}: ä¸æ”¯æŒ`, 'error');
                        }
                    } catch (e) {
                        addResult(`âŒ ${name}: é”™è¯¯ - ${e.message}`, 'error');
                    }
                });
                
            } catch (e) {
                addResult(`âŒ JavaScriptæ£€æµ‹å¤±è´¥: ${e.message}`, 'error');
            }
            
            // React Native Web ç›¸å…³æ£€æµ‹
            addResult('<strong>ğŸ”§ React Native Web å…¼å®¹æ€§æ£€æµ‹</strong>', 'info');
            
            try {
                // æ£€æŸ¥å¿…è¦çš„å…¨å±€å¯¹è±¡
                const globalTests = [
                    { name: 'windowå¯¹è±¡', obj: window },
                    { name: 'documentå¯¹è±¡', obj: document },
                    { name: 'globalThiså¯¹è±¡', obj: globalThis },
                    { name: 'requestAnimationFrame', obj: window.requestAnimationFrame }
                ];
                
                globalTests.forEach(({name, obj}) => {
                    if (obj) {
                        addResult(`âœ… ${name}: å­˜åœ¨`);
                    } else {
                        addResult(`âŒ ${name}: ç¼ºå¤±`, 'error');
                    }
                });
                
                // DOM APIæ£€æµ‹
                const domTests = [
                    { name: 'getElementById', test: () => document.getElementById },
                    { name: 'createElement', test: () => document.createElement },
                    { name: 'addEventListener', test: () => window.addEventListener },
                    { name: 'fetch API', test: () => window.fetch }
                ];
                
                domTests.forEach(({name, test}) => {
                    if (test()) {
                        addResult(`âœ… ${name}: æ”¯æŒ`);
                    } else {
                        addResult(`âŒ ${name}: ä¸æ”¯æŒ`, 'error');
                        if (name === 'fetch API') {
                            addResult('ğŸ’¡ æç¤º: fetch APIæ˜¯åŠ è½½åº”ç”¨èµ„æºçš„å¿…è¦æ¡ä»¶', 'warning');
                        }
                    }
                });
                
            } catch (e) {
                addResult(`âŒ ç¯å¢ƒæ£€æµ‹å¤±è´¥: ${e.message}`, 'error');
            }
            
            // å°è¯•åŠ è½½åº”ç”¨è„šæœ¬
            addResult('<strong>ğŸ“¦ åº”ç”¨è„šæœ¬åŠ è½½æµ‹è¯•</strong>', 'info');
            
            const script = document.createElement('script');
            script.src = './_expo/static/js/web/AppEntry-e4617e58fe499b6e9b1217e203ffb406.js';
            script.defer = true;
            
            script.onload = () => {
                addResult('âœ… åº”ç”¨è„šæœ¬åŠ è½½æˆåŠŸ');
                
                // æ£€æŸ¥React Nativeæ˜¯å¦åˆå§‹åŒ–
                setTimeout(() => {
                    addResult('<strong>ğŸš€ React Native åˆå§‹åŒ–æ£€æµ‹</strong>', 'info');
                    
                    try {
                        // æ£€æŸ¥å…¨å±€å˜é‡
                        if (window.ReactNativeWeb) {
                            addResult('âœ… ReactNativeWebå…¨å±€å˜é‡å­˜åœ¨');
                        }
                        
                        // æ£€æŸ¥rootå…ƒç´ 
                        const rootElement = document.getElementById('root');
                        if (rootElement) {
                            addResult('âœ… Rootå…ƒç´ å­˜åœ¨');
                            
                            // æ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹è¢«æ¸²æŸ“
                            if (rootElement.children.length > 0) {
                                addResult('âœ… Rootå…ƒç´ æœ‰å­å…ƒç´ ï¼Œåº”ç”¨å¯èƒ½å·²æ¸²æŸ“');
                            } else {
                                addResult('âš ï¸ Rootå…ƒç´ ä¸ºç©ºï¼Œåº”ç”¨å¯èƒ½æœªæ¸²æŸ“', 'warning');
                                addResult('ğŸ’¡ å¯èƒ½åŸå› : JavaScripté”™è¯¯ã€ä¾èµ–ç¼ºå¤±æˆ–åˆå§‹åŒ–å¤±è´¥', 'warning');
                            }
                        } else {
                            addResult('âŒ Rootå…ƒç´ ä¸å­˜åœ¨', 'error');
                        }
                        
                    } catch (e) {
                        addResult(`âŒ React Nativeæ£€æµ‹å¤±è´¥: ${e.message}`, 'error');
                    }
                    
                    addResult('<strong>ğŸ“‹ è¯Šæ–­å®Œæˆ</strong>', 'info');
                    if (errorCount === 0) {
                        addResult('ğŸ‰ æœªå‘ç°æ˜æ˜¾å…¼å®¹æ€§é—®é¢˜ï¼åº”ç”¨åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œã€‚', 'success');
                    } else {
                        addResult(`âš ï¸ å‘ç° ${errorCount} ä¸ªæ½œåœ¨é—®é¢˜ï¼Œè¯·å‚è€ƒä¸Šé¢çš„å»ºè®®ã€‚`, 'warning');
                    }
                }, 2000);
            };
            
            script.onerror = (error) => {
                addResult(`âŒ åº”ç”¨è„šæœ¬åŠ è½½å¤±è´¥`, 'error');
                addResult(`ğŸ’¡ è¯·æ£€æŸ¥:`, 'warning');
                addResult(`   â€¢ æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®`);
                addResult(`   â€¢ æ–‡ä»¶æ˜¯å¦å­˜åœ¨`);
                addResult(`   â€¢ æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ`);
                addResult(`   â€¢ æµè§ˆå™¨æ˜¯å¦æœ‰ç½‘ç»œè®¿é—®æƒé™`);
                
                // å°è¯•è®¿é—®æµ‹è¯•æ–‡ä»¶
                fetch('./_expo/static/js/web/AppEntry-e4617e58fe499b6e9b1217e203ffb406.js')
                    .then(response => {
                        if (response.ok) {
                            addResult(`âœ… æ–‡ä»¶å¯è®¿é—® (HTTP ${response.status})`);
                        } else {
                            addResult(`âŒ æ–‡ä»¶è®¿é—®å¤±è´¥ (HTTP ${response.status})`, 'error');
                        }
                    })
                    .catch(err => {
                        addResult(`âŒ ç½‘ç»œè¯·æ±‚å¤±è´¥: ${err.message}`, 'error');
                    });
            };
            
            document.head.appendChild(script);
            
            // ç›‘å¬å…¨å±€é”™è¯¯
            window.addEventListener('error', (event) => {
                addResult(`âŒ å…¨å±€é”™è¯¯: ${event.message}`, 'error');
                if (event.filename) {
                    addResult(`ğŸ“ é”™è¯¯æ–‡ä»¶: ${event.filename}:${event.lineno}:${event.colno}`, 'warning');
                }
            });
            
            window.addEventListener('unhandledrejection', (event) => {
                addResult(`âŒ æœªå¤„ç†çš„Promiseæ‹’ç»: ${event.reason}`, 'error');
            });
            
        }, 1000);
    </script>
</body>
</html>